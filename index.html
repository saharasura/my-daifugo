<!DOCTYPE html>

<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å¤§å¯Œè±ª</title>

  <!-- Firebase Compatibility SDK -->

  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>

  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

  <!-- React -->

  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>

  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Babel -->

  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Tailwind CSS -->

  <script src="https://cdn.tailwindcss.com"></script>

</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // Lucide Icons
    const Eye = () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>;
    const EyeOff = () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/></svg>;
    const Users = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>;
    const LogOut = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>;
    const Copy = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>;
    const Check = () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="20 6 9 17 4 12"/></svg>;
    const RotateCcw = () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="1 4 1 10 7 10"/><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/></svg>;

    const OnlineDaifugoGame = () => {
      const [database, setDatabase] = useState(null);
      const [gameState, setGameState] = useState('lobby');
      const [roomId, setRoomId] = useState('');
      const [inputRoomId, setInputRoomId] = useState('');
      const [playerId, setPlayerId] = useState('');
      const [playerName, setPlayerName] = useState('');
      const [inputPlayerName, setInputPlayerName] = useState('');
      
      const [gameData, setGameData] = useState(null);
      const [myPlayerIndex, setMyPlayerIndex] = useState(-1);
      const [showHand, setShowHand] = useState(true);
      const [selectedCards, setSelectedCards] = useState([]);
      const [message, setMessage] = useState('');
      const [copied, setCopied] = useState(false);

      const SUITS = {
        hearts: { symbol: 'â™¥', color: 'text-red-500' },
        diamonds: { symbol: 'â™¦', color: 'text-red-500' },
        clubs: { symbol: 'â™£', color: 'text-gray-800' },
        spades: { symbol: 'â™ ', color: 'text-gray-800' }
      };

      const RANKS = ['3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A', '2'];
      
      const getRankValue = (rank) => RANKS.indexOf(rank);

      // localStorageã‹ã‚‰ä¿å­˜ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
      const loadFromStorage = () => {
        try {
          const savedPlayerId = localStorage.getItem('daifugo_playerId');
          const savedPlayerName = localStorage.getItem('daifugo_playerName');
          const savedRoomId = localStorage.getItem('daifugo_roomId');
          
          return { savedPlayerId, savedPlayerName, savedRoomId };
        } catch (error) {
          console.error('localStorageèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
          return { savedPlayerId: null, savedPlayerName: null, savedRoomId: null };
        }
      };

      // localStorageã«ä¿å­˜
      const saveToStorage = (pid, pname, rid) => {
        try {
          if (pid) localStorage.setItem('daifugo_playerId', pid);
          if (pname) localStorage.setItem('daifugo_playerName', pname);
          if (rid) localStorage.setItem('daifugo_roomId', rid);
        } catch (error) {
          console.error('localStorageä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
        }
      };

      // localStorageã‚’ã‚¯ãƒªã‚¢
      const clearStorage = () => {
        try {
          localStorage.removeItem('daifugo_playerId');
          localStorage.removeItem('daifugo_playerName');
          localStorage.removeItem('daifugo_roomId');
        } catch (error) {
          console.error('localStorageã‚¯ãƒªã‚¢ã‚¨ãƒ©ãƒ¼:', error);
        }
      };

      // FirebaseåˆæœŸåŒ–
      useEffect(() => {
        try {
          // Firebaseè¨­å®š
          const firebaseConfig = {
            apiKey: "AIzaSyAphoRCf5yD80micou5WBvH8Y7MtBTK-uI",
            authDomain: "my-daifugo-game.firebaseapp.com",
            databaseURL: "https://my-daifugo-game-default-rtdb.firebaseio.com",
            projectId: "my-daifugo-game",
            storageBucket: "my-daifugo-game.firebasestorage.app",
            messagingSenderId: "119119094779",
            appId: "1:119119094779:web:701573efd01b1116b2e15e"
          };

          // FirebaseåˆæœŸåŒ–
          if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
          }
          
          const db = firebase.database();
          setDatabase(db);

          // localStorageã‹ã‚‰å¾©å…ƒã‚’è©¦ã¿ã‚‹
          const { savedPlayerId, savedPlayerName, savedRoomId } = loadFromStorage();
          
          if (savedPlayerId && savedPlayerName && savedRoomId) {
            // ä¿å­˜ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹å ´åˆã¯å¾©å…ƒ
            setPlayerId(savedPlayerId);
            setPlayerName(savedPlayerName);
            setRoomId(savedRoomId);
            setGameState('waiting'); // ä¸€æ—¦å¾…æ©Ÿç”»é¢ã«
            console.log('localStorageã‹ã‚‰å¾©å…ƒ:', savedPlayerId, savedPlayerName, savedRoomId);
          } else {
            // æ–°è¦ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼IDç”Ÿæˆ
            const id = 'player_' + Math.random().toString(36).substr(2, 9);
            setPlayerId(id);
            console.log('æ–°è¦ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼IDç”Ÿæˆ:', id);
          }
          
          console.log('FirebaseåˆæœŸåŒ–æˆåŠŸ');
        } catch (error) {
          console.error('FirebaseåˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
          setMessage('âŒ Firebaseæ¥ç¶šã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
        }
      }, []);

      // ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ ã‚’ãƒªã‚¹ãƒ‹ãƒ³ã‚°
      useEffect(() => {
        if (!database || !roomId || !playerId) return;

        console.log('ãƒ«ãƒ¼ãƒ ãƒªã‚¹ãƒ‹ãƒ³ã‚°é–‹å§‹:', roomId);
        const roomRef = database.ref('rooms/' + roomId);
        
        const listener = roomRef.on('value', (snapshot) => {
          const data = snapshot.val();
          
          if (!data) {
            console.log('ãƒ«ãƒ¼ãƒ ãŒå­˜åœ¨ã—ã¾ã›ã‚“');
            setMessage('âš ï¸ ãƒ«ãƒ¼ãƒ ãŒå‰Šé™¤ã•ã‚Œã¾ã—ãŸ');
            clearStorage();
            setRoomId('');
            setGameData(null);
            setMyPlayerIndex(-1);
            setGameState('lobby');
            return;
          }

          console.log('ã‚²ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿æ›´æ–°:', data);
          setGameData(data);
          
          const index = data.players ? data.players.findIndex(p => p && p.id === playerId) : -1;
          setMyPlayerIndex(index);
          
          if (index === -1) {
            console.log('è‡ªåˆ†ãŒãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒªã‚¹ãƒˆã«ã„ã¾ã›ã‚“');
            setMessage('âš ï¸ ãƒ«ãƒ¼ãƒ ã‹ã‚‰åˆ‡æ–­ã•ã‚Œã¾ã—ãŸ');
            clearStorage();
            setRoomId('');
            setGameData(null);
            setGameState('lobby');
            return;
          }

          if (data.winner) {
            setGameState('gameover');
          } else if (data.gameStarted) {
            setGameState('playing');
          } else {
            setGameState('waiting');
          }
        });

        return () => {
          console.log('ãƒ«ãƒ¼ãƒ ãƒªã‚¹ãƒ‹ãƒ³ã‚°è§£é™¤');
          roomRef.off('value', listener);
        };
      }, [database, roomId, playerId]);

      const createAndShuffleDeck = () => {
        const deck = [];
        Object.keys(SUITS).forEach(suit => {
          RANKS.forEach(rank => {
            deck.push({ suit, rank, id: `${suit}-${rank}` });
          });
        });
        
        for (let i = deck.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [deck[i], deck[j]] = [deck[j], deck[i]];
        }
        return deck;
      };

      const createRoom = async () => {
        if (!database) {
          setMessage('âŒ Firebaseã®åˆæœŸåŒ–ã‚’å¾…ã£ã¦ã„ã¾ã™...');
          return;
        }

        const name = inputPlayerName.trim();
        if (!name) {
          setMessage('âŒ åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
          return;
        }

        try {
          const newRoomRef = database.ref('rooms').push();
          const newRoomId = newRoomRef.key;

          const initialData = {
            players: [
              {
                id: playerId,
                name: name,
                hand: [],
                hasPassed: false
              }
            ],
            currentPlayerIndex: 0,
            fieldCards: [],
            lastPlayedBy: null,
            passCount: 0,
            gameStarted: false,
            winner: null,
            createdAt: Date.now()
          };

          await newRoomRef.set(initialData);
          
          // localStorageã«ä¿å­˜
          saveToStorage(playerId, name, newRoomId);
          
          setRoomId(newRoomId);
          setPlayerName(name);
          setGameState('waiting');
          setMessage('');
          console.log('ãƒ«ãƒ¼ãƒ ä½œæˆæˆåŠŸ:', newRoomId);
        } catch (error) {
          console.error('ãƒ«ãƒ¼ãƒ ä½œæˆã‚¨ãƒ©ãƒ¼:', error);
          setMessage('âŒ ãƒ«ãƒ¼ãƒ ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
        }
      };

      const joinRoom = async () => {
        if (!database) {
          setMessage('âŒ Firebaseã®åˆæœŸåŒ–ã‚’å¾…ã£ã¦ã„ã¾ã™...');
          return;
        }

        const roomIdInput = inputRoomId.trim();
        const name = inputPlayerName.trim();
        
        if (!roomIdInput) {
          setMessage('âŒ ãƒ«ãƒ¼ãƒ IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
          return;
        }
        
        if (!name) {
          setMessage('âŒ åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
          return;
        }

        try {
          const roomRef = database.ref('rooms/' + roomIdInput);
          const snapshot = await roomRef.once('value');
          
          if (!snapshot.exists()) {
            setMessage('âŒ ãƒ«ãƒ¼ãƒ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
            return;
          }

          const roomData = snapshot.val();
          
          if (roomData.gameStarted) {
            setMessage('âŒ ã‚²ãƒ¼ãƒ ã¯æ—¢ã«é–‹å§‹ã•ã‚Œã¦ã„ã¾ã™');
            return;
          }

          if (roomData.players && roomData.players.length >= 4) {
            setMessage('âŒ ãƒ«ãƒ¼ãƒ ãŒæº€å“¡ã§ã™');
            return;
          }

          const newPlayer = {
            id: playerId,
            name: name,
            hand: [],
            hasPassed: false
          };

          const updates = {};
          const playerCount = roomData.players ? roomData.players.length : 0;
          updates['players/' + playerCount] = newPlayer;
          
          await roomRef.update(updates);

          // localStorageã«ä¿å­˜
          saveToStorage(playerId, name, roomIdInput);

          setRoomId(roomIdInput);
          setPlayerName(name);
          setGameState('waiting');
          setMessage('');
          console.log('ãƒ«ãƒ¼ãƒ å‚åŠ æˆåŠŸ');
        } catch (error) {
          console.error('ãƒ«ãƒ¼ãƒ å‚åŠ ã‚¨ãƒ©ãƒ¼:', error);
          setMessage('âŒ ãƒ«ãƒ¼ãƒ å‚åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
        }
      };

      const startGame = async () => {
        if (!database || !roomId || !gameData) {
          console.error('ã‚²ãƒ¼ãƒ é–‹å§‹: å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“', { database, roomId, gameData });
          setMessage('âŒ ãƒ‡ãƒ¼ã‚¿ã®æº–å‚™ãŒã§ãã¦ã„ã¾ã›ã‚“');
          return;
        }

        if (!gameData.players || gameData.players.length < 2) {
          setMessage('âŒ æœ€ä½2äººå¿…è¦ã§ã™');
          return;
        }

        try {
          console.log('ã‚²ãƒ¼ãƒ é–‹å§‹å‡¦ç†é–‹å§‹');
          const deck = createAndShuffleDeck();
          const playerCount = gameData.players.length;
          const playerHands = Array(playerCount).fill(null).map(() => []);
          
          // ã‚«ãƒ¼ãƒ‰ã‚’é…ã‚‹
          deck.forEach((card, index) => {
            playerHands[index % playerCount].push(card);
          });

          // å„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ‰‹æœ­ã‚’ã‚½ãƒ¼ãƒˆ
          playerHands.forEach(hand => {
            hand.sort((a, b) => getRankValue(a.rank) - getRankValue(b.rank));
          });

          const updates = {};
          
          // å„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æ‰‹æœ­ã‚’æ›´æ–°
          for (let i = 0; i < gameData.players.length; i++) {
            if (gameData.players[i]) {
              updates['players/' + i + '/hand'] = playerHands[i];
              updates['players/' + i + '/hasPassed'] = false;
            }
          }
          
          updates['gameStarted'] = true;
          updates['currentPlayerIndex'] = 0;
          updates['fieldCards'] = [];
          updates['lastPlayedBy'] = null;
          updates['passCount'] = 0;
          updates['winner'] = null;

          console.log('Firebaseæ›´æ–°ä¸­...', updates);
          await database.ref('rooms/' + roomId).update(updates);
          
          setMessage('');
          console.log('ã‚²ãƒ¼ãƒ é–‹å§‹æˆåŠŸ');
        } catch (error) {
          console.error('ã‚²ãƒ¼ãƒ é–‹å§‹ã‚¨ãƒ©ãƒ¼:', error);
          setMessage('âŒ ã‚²ãƒ¼ãƒ é–‹å§‹ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
        }
      };

      const toggleCardSelection = (cardId) => {
        setSelectedCards(prev => 
          prev.includes(cardId) 
            ? prev.filter(id => id !== cardId)
            : [...prev, cardId]
        );
      };

      const canPlayCards = () => {
        if (!gameData || myPlayerIndex === -1 || selectedCards.length === 0) return false;
        if (gameData.currentPlayerIndex !== myPlayerIndex) return false;
        if (selectedCards.length > 1) return false;
        
        const myHand = gameData.players[myPlayerIndex]?.hand;
        if (!myHand) return false;
        
        const selectedCard = myHand.find(c => c.id === selectedCards[0]);
        
        if (!selectedCard) return false;
        if (!gameData.fieldCards || gameData.fieldCards.length === 0) return true;
        
        const lastCard = gameData.fieldCards[gameData.fieldCards.length - 1];
        return getRankValue(selectedCard.rank) > getRankValue(lastCard.rank);
      };

      const playCards = async () => {
        if (!canPlayCards() || !database || !roomId) {
          setMessage('âŒ ãã®ã‚«ãƒ¼ãƒ‰ã¯å‡ºã›ã¾ã›ã‚“');
          return;
        }

        try {
          const myHand = gameData.players[myPlayerIndex].hand;
          const playedCards = myHand.filter(c => selectedCards.includes(c.id));
          const newHand = myHand.filter(c => !selectedCards.includes(c.id));

          const updates = {};
          updates['players/' + myPlayerIndex + '/hand'] = newHand;
          updates['players/' + myPlayerIndex + '/hasPassed'] = false;
          updates['fieldCards'] = playedCards;
          updates['lastPlayedBy'] = myPlayerIndex;
          updates['passCount'] = 0;

          if (newHand.length === 0) {
            updates['winner'] = gameData.players[myPlayerIndex].name;
          } else {
            const nextIndex = (myPlayerIndex + 1) % gameData.players.length;
            updates['currentPlayerIndex'] = nextIndex;
          }

          await database.ref('rooms/' + roomId).update(updates);
          setSelectedCards([]);
          setMessage('');
        } catch (error) {
          console.error('ã‚«ãƒ¼ãƒ‰å‡ºã—ã‚¨ãƒ©ãƒ¼:', error);
          setMessage('âŒ ã‚«ãƒ¼ãƒ‰ã‚’å‡ºã›ã¾ã›ã‚“ã§ã—ãŸ');
        }
      };

      const pass = async () => {
        if (!database || !roomId || !gameData) return;
        if (gameData.currentPlayerIndex !== myPlayerIndex) return;

        try {
          const newPassCount = gameData.passCount + 1;
          const updates = {};
          
          updates['players/' + myPlayerIndex + '/hasPassed'] = true;
          updates['passCount'] = newPassCount;

          if (newPassCount === gameData.players.length - 1) {
            updates['fieldCards'] = [];
            updates['lastPlayedBy'] = null;
            updates['passCount'] = 0;
            
            gameData.players.forEach((_, index) => {
              updates['players/' + index + '/hasPassed'] = false;
            });
          }

          let nextIndex = (myPlayerIndex + 1) % gameData.players.length;
          let skipped = 0;
          
          while (skipped < gameData.players.length) {
            if (newPassCount === gameData.players.length - 1 || !gameData.players[nextIndex]?.hasPassed) {
              break;
            }
            nextIndex = (nextIndex + 1) % gameData.players.length;
            skipped++;
          }
          
          updates['currentPlayerIndex'] = nextIndex;

          await database.ref('rooms/' + roomId).update(updates);
          setMessage('');
        } catch (error) {
          console.error('ãƒ‘ã‚¹ã‚¨ãƒ©ãƒ¼:', error);
          setMessage('âŒ ãƒ‘ã‚¹ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
      };

      const leaveRoom = async () => {
        if (!database || !roomId) return;
        
        try {
          await database.ref('rooms/' + roomId).remove();
          
          // localStorageã‚¯ãƒªã‚¢
          clearStorage();
          
          setRoomId('');
          setGameData(null);
          setMyPlayerIndex(-1);
          setGameState('lobby');
          setMessage('');
        } catch (error) {
          console.error('é€€å‡ºã‚¨ãƒ©ãƒ¼:', error);
        }
      };

      const copyRoomId = () => {
        navigator.clipboard.writeText(roomId);
        setCopied(true);
        setTimeout(() => setCopied(false), 2000);
      };

      const Card = ({ card, isSelected, onClick, size = 'normal' }) => {
        if (!card) return null;
        
        const suitInfo = SUITS[card.suit];
        if (!suitInfo) return null;
        
        const sizeClasses = size === 'small' 
          ? 'w-12 h-16 text-xs' 
          : 'w-16 h-24 text-base';
        
        return (
          <div
            onClick={onClick}
            className={`${sizeClasses} bg-white rounded-lg shadow-md flex flex-col items-center justify-center border-2 transition-all
              ${isSelected ? 'border-blue-500 -translate-y-2' : 'border-gray-300'}
              ${onClick ? 'cursor-pointer active:scale-95' : ''}`}
          >
            <div className={`font-bold ${suitInfo.color}`}>
              {card.rank}
            </div>
            <div className={`text-2xl ${suitInfo.color}`}>
              {suitInfo.symbol}
            </div>
          </div>
        );
      };

      // å®‰å…¨ã«ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
      const currentPlayer = gameData?.players?.[gameData.currentPlayerIndex];
      const myPlayer = (myPlayerIndex >= 0 && gameData?.players) ? gameData.players[myPlayerIndex] : null;
      const isMyTurn = gameData?.currentPlayerIndex === myPlayerIndex;

      return (
        <div className="min-h-screen bg-gradient-to-b from-green-800 to-green-600 flex flex-col items-center justify-center p-4">
          
          {/* ãƒ­ãƒ“ãƒ¼ç”»é¢ */}
          {gameState === 'lobby' && (
            <div className="bg-white rounded-2xl p-8 shadow-2xl max-w-md w-full">
              <h1 className="text-4xl font-bold mb-4 text-green-800 text-center">ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å¤§å¯Œè±ª</h1>
              <p className="text-gray-600 mb-6 text-center">4äººå¯¾æˆ¦ã‚«ãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ </p>
              
              {message && (
                <div className="bg-red-50 border border-red-200 rounded-lg p-3 mb-4 text-sm text-red-800">
                  {message}
                </div>
              )}

              <div className="mb-6">
                <label className="block text-sm font-bold text-gray-700 mb-2">
                  ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å
                </label>
                <input
                  type="text"
                  value={inputPlayerName}
                  onChange={(e) => setInputPlayerName(e.target.value)}
                  placeholder="åå‰ã‚’å…¥åŠ›"
                  className="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-green-500 focus:outline-none"
                  maxLength={15}
                />
              </div>

              <div className="space-y-3 mb-6">
                <button
                  onClick={createRoom}
                  disabled={!database}
                  className={`w-full py-4 rounded-xl text-lg font-bold transition-all shadow-lg flex items-center justify-center gap-2
                    ${database 
                      ? 'bg-green-600 text-white hover:bg-green-700 active:scale-95' 
                      : 'bg-gray-300 text-gray-500 cursor-not-allowed'}`}
                >
                  <Users />
                  æ–°ã—ã„ãƒ«ãƒ¼ãƒ ã‚’ä½œæˆ
                </button>

                <div className="relative">
                  <div className="absolute inset-0 flex items-center">
                    <div className="w-full border-t border-gray-300"></div>
                  </div>
                  <div className="relative flex justify-center text-sm">
                    <span className="px-4 bg-white text-gray-500">ã¾ãŸã¯</span>
                  </div>
                </div>

                <input
                  type="text"
                  value={inputRoomId}
                  onChange={(e) => setInputRoomId(e.target.value)}
                  placeholder="ãƒ«ãƒ¼ãƒ IDã‚’å…¥åŠ›"
                  className="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:outline-none"
                />

                <button
                  onClick={joinRoom}
                  disabled={!database}
                  className={`w-full py-4 rounded-xl text-lg font-bold transition-all shadow-lg
                    ${database 
                      ? 'bg-blue-600 text-white hover:bg-blue-700 active:scale-95' 
                      : 'bg-gray-300 text-gray-500 cursor-not-allowed'}`}
                >
                  ãƒ«ãƒ¼ãƒ ã«å‚åŠ 
                </button>
              </div>

              <div className="bg-gray-50 rounded-lg p-4 text-left text-sm">
                <h3 className="font-bold mb-2">ğŸ“– ãƒ«ãƒ¼ãƒ«</h3>
                <ul className="space-y-1 text-gray-700">
                  <li>â€¢ 2ã€œ4äººã§ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å¯¾æˆ¦</li>
                  <li>â€¢ å‰ã®äººã‚ˆã‚Šå¼·ã„ã‚«ãƒ¼ãƒ‰ã‚’å‡ºã™</li>
                  <li>â€¢ å¼·ã•: 2 {'>'} A {'>'} K ... {'>'} 3</li>
                  <li>â€¢ æ‰‹æœ­ãŒ0æšã«ãªã£ãŸã‚‰å‹åˆ©ï¼</li>
                </ul>
              </div>

              {!database && (
                <div className="mt-4 text-center text-sm text-gray-500">
                  Firebaseæ¥ç¶šä¸­...
                </div>
              )}
            </div>
          )}

          {/* å¾…æ©Ÿç”»é¢ */}
          {gameState === 'waiting' && gameData && (
            <div className="bg-white rounded-2xl p-8 shadow-2xl max-w-md w-full">
              <h2 className="text-2xl font-bold mb-4 text-green-800 text-center">
                ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼å¾…æ©Ÿä¸­
              </h2>

              <div className="bg-blue-50 border-2 border-blue-200 rounded-lg p-4 mb-6">
                <p className="text-sm text-gray-600 mb-2 text-center">ãƒ«ãƒ¼ãƒ ID</p>
                <div className="flex items-center gap-2">
                  <code className="flex-1 bg-white px-4 py-3 rounded-lg font-mono text-lg text-center border-2 border-blue-300">
                    {roomId}
                  </code>
                  <button
                    onClick={copyRoomId}
                    className="p-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 active:scale-95 transition-all"
                  >
                    {copied ? <Check /> : <Copy />}
                  </button>
                </div>
                <p className="text-xs text-gray-600 mt-2 text-center">
                  å‹é”ã«ã“ã®IDã‚’å…±æœ‰ã—ã¦ãã ã•ã„
                </p>
              </div>

              {gameData.players && (
                <div className="mb-6">
                  <h3 className="font-bold text-gray-700 mb-3">
                    å‚åŠ è€… ({gameData.players.length}/4)
                  </h3>
                  <div className="space-y-2">
                    {gameData.players.map((player, index) => (
                      player && (
                        <div
                          key={player.id || index}
                          className={`p-3 rounded-lg border-2 ${
                            player.id === playerId
                              ? 'bg-green-50 border-green-300'
                              : 'bg-gray-50 border-gray-200'
                          }`}
                        >
                          <div className="flex items-center justify-between">
                            <span className="font-bold">
                              {player.name}
                              {player.id === playerId && ' (ã‚ãªãŸ)'}
                            </span>
                            {index === 0 && (
                              <span className="text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded">
                                ãƒ›ã‚¹ãƒˆ
                              </span>
                            )}
                          </div>
                        </div>
                      )
                    ))}
                  </div>
                </div>
              )}

              <div className="space-y-3">
                {myPlayerIndex === 0 && (
                  <button
                    onClick={startGame}
                    disabled={!gameData.players || gameData.players.length < 2}
                    className={`w-full py-4 rounded-xl text-lg font-bold transition-all shadow-lg
                      ${gameData.players && gameData.players.length >= 2
                        ? 'bg-green-600 text-white hover:bg-green-700 active:scale-95'
                        : 'bg-gray-300 text-gray-500 cursor-not-allowed'}`}
                  >
                    ã‚²ãƒ¼ãƒ é–‹å§‹ (2äººä»¥ä¸Š)
                  </button>
                )}

                <button
                  onClick={leaveRoom}
                  className="w-full bg-gray-500 text-white py-3 rounded-xl font-bold hover:bg-gray-600 active:scale-95 transition-all flex items-center justify-center gap-2"
                >
                  <LogOut />
                  ãƒ«ãƒ¼ãƒ ã‚’é€€å‡º
                </button>
              </div>
            </div>
          )}

          {/* ãƒ—ãƒ¬ã‚¤ç”»é¢ */}
          {gameState === 'playing' && gameData && myPlayer && (
            <div className="w-full max-w-md">
              <div className="bg-white rounded-2xl p-4 mb-4 shadow-lg">
                <div className="flex justify-between items-center mb-2">
                  <div>
                    <h2 className="text-xl font-bold text-green-800">
                      {myPlayer.name || 'ã‚ãªãŸ'}
                    </h2>
                    <p className="text-sm text-gray-600">
                      æ®‹ã‚Š: {myPlayer.hand ? myPlayer.hand.length : 0}æš
                    </p>
                  </div>
                  <div className="text-right">
                    <p className="text-sm text-gray-600">ç¾åœ¨ã®ã‚¿ãƒ¼ãƒ³</p>
                    <p className={`text-lg font-bold ${isMyTurn ? 'text-green-600' : 'text-gray-600'}`}>
                      {currentPlayer?.name || '...'}
                      {isMyTurn && ' ğŸ¯'}
                    </p>
                  </div>
                </div>
                
                {message && (
                  <div className="bg-blue-50 border border-blue-200 rounded-lg p-2 text-sm text-blue-800">
                    {message}
                  </div>
                )}

                {!isMyTurn && (
                  <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-2 text-sm text-yellow-800">
                    ç›¸æ‰‹ã®ã‚¿ãƒ¼ãƒ³ã‚’å¾…ã£ã¦ã„ã¾ã™...
                  </div>
                )}
              </div>

              <div className="bg-white/90 rounded-xl p-4 mb-4 shadow-lg">
                <h3 className="text-sm font-bold text-gray-700 mb-2">å ´ã®ã‚«ãƒ¼ãƒ‰</h3>
                <div className="min-h-24 flex items-center justify-center">
                  {gameData.fieldCards && gameData.fieldCards.length > 0 ? (
                    <Card card={gameData.fieldCards[0]} />
                  ) : (
                    <p className="text-gray-400">ã‚«ãƒ¼ãƒ‰ãªã—</p>
                  )}
                </div>
              </div>

              <div className="bg-white rounded-xl p-4 mb-4 shadow-lg">
                <div className="flex justify-between items-center mb-3">
                  <h3 className="text-sm font-bold text-gray-700">ã‚ãªãŸã®æ‰‹æœ­</h3>
                  <button
                    onClick={() => setShowHand(!showHand)}
                    className="flex items-center gap-1 text-sm text-blue-600"
                  >
                    {showHand ? <EyeOff /> : <Eye />}
                    {showHand ? 'éš ã™' : 'è¡¨ç¤º'}
                  </button>
                </div>
                
                {showHand ? (
                  <div className="flex flex-wrap gap-2 justify-center">
                    {myPlayer.hand && myPlayer.hand.length > 0 ? (
                      myPlayer.hand.map(card => (
                        <Card
                          key={card.id}
                          card={card}
                          isSelected={selectedCards.includes(card.id)}
                          onClick={isMyTurn ? () => toggleCardSelection(card.id) : undefined}
                        />
                      ))
                    ) : (
                      <p className="text-gray-400">æ‰‹æœ­ãŒã‚ã‚Šã¾ã›ã‚“</p>
                    )}
                  </div>
                ) : (
                  <div className="h-24 flex items-center justify-center text-gray-400">
                    ğŸ‘† è¡¨ç¤ºãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„
                  </div>
                )}
              </div>

              <div className="flex gap-2 mb-4">
                <button
                  onClick={pass}
                  disabled={!isMyTurn}
                  className={`flex-1 py-4 rounded-xl text-lg font-bold transition-all shadow-lg
                    ${isMyTurn
                      ? 'bg-gray-500 text-white hover:bg-gray-600 active:scale-95'
                      : 'bg-gray-300 text-gray-500 cursor-not-allowed'}`}
                >
                  ãƒ‘ã‚¹
                </button>
                <button
                  onClick={playCards}
                  disabled={!canPlayCards()}
                  className={`flex-1 py-4 rounded-xl text-lg font-bold transition-all shadow-lg
                    ${canPlayCards()
                      ? 'bg-blue-600 text-white hover:bg-blue-700 active:scale-95'
                      : 'bg-gray-300 text-gray-500 cursor-not-allowed'}`}
                >
                  ã‚«ãƒ¼ãƒ‰ã‚’å‡ºã™
                </button>
              </div>

              {gameData.players && (
                <div className="grid grid-cols-2 gap-2 mb-4">
                  {gameData.players.map((player, index) => (
                    player && player.id !== playerId && (
                      <div
                        key={player.id || index}
                        className={`bg-white/80 rounded-lg p-3 text-center text-sm border-2
                          ${index === gameData.currentPlayerIndex ? 'border-green-400' : 'border-transparent'}`}
                      >
                        <div className="font-bold">{player.name}</div>
                        <div className="text-gray-600">
                          {player.hand ? player.hand.length : 0}æš
                          {player.hasPassed && ' (ãƒ‘ã‚¹)'}
                        </div>
                      </div>
                    )
                  ))}
                </div>
              )}

              <button
                onClick={leaveRoom}
                className="w-full bg-red-500 text-white py-3 rounded-xl font-bold hover:bg-red-600 active:scale-95 transition-all flex items-center justify-center gap-2"
              >
                <LogOut />
                ã‚²ãƒ¼ãƒ ã‚’é€€å‡º
              </button>
            </div>
          )}

          {/* ã‚²ãƒ¼ãƒ çµ‚äº†ç”»é¢ */}
          {gameState === 'gameover' && gameData && (
            <div className="bg-white rounded-2xl p-8 shadow-2xl max-w-md w-full text-center">
              <div className="text-6xl mb-4">ğŸ‰</div>
              <h2 className="text-3xl font-bold text-green-800 mb-2">
                ã‚²ãƒ¼ãƒ çµ‚äº†ï¼
              </h2>
              <p className="text-2xl mb-8">
                {gameData.winner} ã®å‹åˆ©ï¼
              </p>

              <div className="space-y-3">
                {myPlayerIndex === 0 && (
                  <button
                    onClick={startGame}
                    className="w-full bg-green-600 text-white py-4 rounded-xl text-xl font-bold hover:bg-green-700 active:scale-95 transition-all shadow-lg flex items-center justify-center gap-2"
                  >
                    <RotateCcw />
                    ã‚‚ã†ä¸€åº¦ãƒ—ãƒ¬ã‚¤
                  </button>
                )}

                <button
                  onClick={leaveRoom}
                  className="w-full bg-gray-500 text-white py-3 rounded-xl font-bold hover:bg-gray-600 active:scale-95 transition-all flex items-center justify-center gap-2"
                >
                  <LogOut />
                  ãƒ­ãƒ“ãƒ¼ã«æˆ»ã‚‹
                </button>
              </div>
            </div>
          )}
        </div>
      );
    };

    ReactDOM.render(<OnlineDaifugoGame />, document.getElementById('root'));
  </script>

</body>
</html>
